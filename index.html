<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>CiteFast ‚Äì APA 7 Citation Generator</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet"/>
<style>
/* [ALL your old CSS from the HTML you pasted goes here] */
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
:root { --bg:#ffffff; --surface:#f9f9f9; --border:#e5e5e5; --green:#16a34a; --green-light:#f0fdf4; --green-border:#bbf7d0; --muted:#888; --text:#1a1a1a; --font:'Inter', sans-serif; }
/* ‚Ä¶ (rest of your CSS exactly as in your old HTML) ‚Ä¶ */
</style>
</head>
<body>

<header>
  <div class="logo">Cite<span>Fast</span></div>
  <div class="badge">APA 7</div>
</header>

<div class="layout">

  <aside class="left-panel">
    <div class="panel-label">Source type</div>
    <ul class="source-list" id="sourceNav">
      <li><button class="active" data-type="website">üåê Website</button></li>
      <li><button data-type="book">üìñ Book</button></li>
      <li><button data-type="journal">üìÑ Journal</button></li>
      <li><button data-type="newspaper">üì∞ Newspaper</button></li>
      <li><button data-type="youtube">‚ñ∂Ô∏è YouTube</button></li>
    </ul>
  </aside>

  <main class="main-panel">

    <div class="search-wrap">
      <input class="search-input" id="urlInput" type="text" placeholder="Paste a URL to auto-fill fields‚Ä¶"/>
      <button class="btn btn-primary" id="searchBtn" onclick="fetchMeta()">Auto-Fill</button>
    </div>

    <div class="loader" id="loader">
      <div class="spinner"></div>
      Fetching page info‚Ä¶
    </div>

    <div class="form-card">
      <h2 id="formTitle">Website</h2>
      <div class="form-grid" id="formGrid"></div>
      <div class="form-actions">
        <button class="btn btn-primary" onclick="generateCitation()">Generate Citation</button>
        <button class="btn btn-ghost" onclick="clearForm()">Clear</button>
      </div>
    </div>

    <div class="result-card" id="resultCard">
      <div class="result-label">Reference</div>
      <div class="citation-text" id="citationOutput"></div>
      <div class="intext-wrap">
        <span class="intext-label">In-text:</span>
        <span class="intext-value" id="inTextOutput"></span>
      </div>
      <div class="result-actions">
        <button class="btn btn-sm btn-ghost" onclick="copyRef()">Copy reference</button>
        <button class="btn btn-sm btn-ghost" onclick="copyInText()">Copy in-text</button>
        <button class="btn btn-sm btn-primary" onclick="saveCitation()">+ Save</button>
      </div>
    </div>

    <div class="saved-section" id="savedSection">
      <div class="saved-header">
        <h3>Saved citations</h3>
        <span class="saved-count" id="savedCount">0</span>
      </div>
      <div class="saved-empty" id="savedEmpty">No citations saved yet.</div>
      <ul class="saved-list" id="savedList"></ul>
      <div class="copy-all-row" id="copyAllRow" style="display:none">
        <button class="btn btn-sm btn-ghost" onclick="copyAll()">Copy all</button>
      </div>
    </div>

  </main>
</div>

<footer>
  Made in Canada
</footer>

<div class="toast" id="toast"></div>

<script>
// [ALL your old JS from the HTML goes here]
// UPDATE fetch URLs for serverless:
async function fetchMeta() {
  const rawUrl = document.getElementById('urlInput').value.trim();
  if (!rawUrl) { toast('Paste a URL first', false); return; }
  const loader = document.getElementById('loader');
  const btn = document.getElementById('searchBtn');
  loader.style.display = 'flex';
  btn.disabled = true;
  try {
    const res  = await fetch('/.netlify/functions/fetch-meta', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ url: rawUrl }) });
    const data = await res.json();
    if (data.ok) { fillFields(data.meta); toast('Fields auto-filled', true); }
    else toast('Could not fetch page ‚Äî fill manually', false);
  } catch { toast('Could not reach server', false); }
  finally { loader.style.display = 'none'; btn.disabled = false; }
}

async function generateCitation() {
  const data = getFormData();
  if (!data.title) { toast('Title is required', false); return; }
  try {
    const res    = await fetch('/.netlify/functions/generate', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(data) });
    const result = await res.json();
    document.getElementById('citationOutput').innerHTML = result.reference;
    document.getElementById('inTextOutput').innerHTML   = result.inText;
    document.getElementById('resultCard').style.display = 'block';
    document.getElementById('resultCard').scrollIntoView({ behavior: 'smooth', block: 'nearest' });
  } catch { toast('Server error', false); }
}

// [Rest of your JS ‚Äî renderForm, saveCitation, toast, etc., exactly as in your HTML]
renderForm('website');
renderSaved();
</script>
</body>
</html>